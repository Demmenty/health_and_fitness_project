<!DOCTYPE html>
{% load static %}
<html lang="ru">
  <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="icon" href="{% static 'general/img/Logo_title.png' %}" type="image/x-icon">
      <link rel="stylesheet" href="{% static 'homepage/homepage_style.css' %}">
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
      <title>{% block title %}{% endblock %}</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  </head>

  <body>

    <header class="border-bottom">
      <div class="container">
        <nav class="navbar navbar-expand-md navbar-light bg-white flex-nowrap">
          <div class="container-fluid px-0">
            <!-- логотип -->
            <a href="/" class="navbar-brand p-0 me-2">
                <img src="{% static 'general/img/Logo.svg' %}" type="image/svg+xml" width="90" id="logo">
                <img src="{% static 'general/img/Logo_mini.svg' %}" type="image/svg+xml" width="90" id="logo_mini"></object>
            </a>
            <!-- список ссылок -->
            <div class="collapse navbar-collapse justify-content-center" id="navbarSupportedContent">
              <ul class="navbar-nav text-center mb-0">
                <li class="nav-item">
                  <a href="#why_section" class="nav_link">о проекте</a>
                </li>
                <li class="nav-item">
                  <a href="#what_section" class="nav_link">услуги</a>
                </li>
                <li class="nav-item">
                  <a href="#consultation_section" class="nav_link">консультация</a>
                </li>
                <li class="nav-item">
                  <a href="#trainer_contacts" class="nav_link">о специалисте</a>
                </li>
              </ul>
              <div class="d-flex flex-column d-sm-none text-center">
                <hr class="my-2 mx-auto" style="width: 110px;">
                {% if user.is_authenticated %}
                  <!-- кнопка входа -->
                    <a href="{{ 'personalpage' }}" id="profile_p" class="nav_link">профиль</a>
                    <form method="POST" action="{% url 'logoutuser' %}" class="form-inline">
                      {% csrf_token %}
                      <input type="Submit" id="exit_p" class="nav_link" title="Выйти" value="выйти">
                    </form>
                {% else %}
                  <!-- кнопки входа/регистрации -->
                  <p class="nav_link" id="login_p" data-bs-toggle="modal" data-bs-target="#login_form_container">вход</button>
                  <p class="nav_link" id="registration_p" data-bs-toggle="modal" data-bs-target="#registration_form_container">регистрация</p>
                {% endif %}
              </div>
            </div>
            <!-- кнопка-гамбургер -->
            <button class="navbar-toggler ms-2 px-2" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
          </div>

          {% if user.is_authenticated %}
          <!-- кнопки входа/выхода -->
          <div class="d-none d-sm-flex text-end justify-content-end">
            <a href="{{ 'personalpage' }}" id="profile_btn">
              <button type="button" class="btn btn-primary ms-3">Профиль</button>
            </a>
            <form method="POST" action="{% url 'logoutuser' %}" class="form-inline ms-3">
              {% csrf_token %}
              <input type="image" alt="Submit" src="{% static 'general/img/exit (thin).svg' %}" id="exit_pic" class="align-middle" title="Выйти">
            </form>
          </div>
          {% else %}
          <!-- кнопки входа/регистрации -->
          <div class="d-none d-sm-flex text-end justify-content-end">
            <button type="button" class="btn btn-primary ms-2" id="login_btn" data-bs-toggle="modal" data-bs-target="#login_form_container">Вход</button>
            <button type="button" class="btn btn-outline-primary ms-2 d-none d-sm-flex" id="registration_btn" data-bs-toggle="modal" data-bs-target="#registration_form_container">Регистрация</button>
          </div>
          {% endif %}
        </nav>
      </div>
    </header>

      
    <!-- формы авторизации -->
    <!-- вход форма -->
    <div class="modal fade" id="login_form_container" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <h4 class="modal-title text-center">АВТОРИЗАЦИЯ</h4><br>
          <form method="POST" action="" id="login_form">
            {% csrf_token %}
            <div class="pad-notop-4">
              <label>Логин</label>
              <p>{{ login_form.username }}</p>
              <label>Пароль</label>
              <p>{{ login_form.password }}</p>
              <span id="login_form_result" class="error">&nbsp;</span>
              <button type="submit" class="btn btn-primary">ВХОД</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- аякс скрипты -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

    <!-- вход скрипт -->
    <script>
        $(document).ready(function () {
            // отслеживаем событие отправки формы
            $('#login_form').submit(function () {

                resultField = document.getElementById("login_form_result");
                
                // создаем AJAX-вызов
                $.ajax({
                    data: $(this).serialize(), // получаем данные формы
                    type: $(this).attr('method'), // метод отправки запроса
                    url: "{% url 'loginuser' %}", // функция обработки
                    
                    // После успешного завершения запросов запускается одна из колбэк-функций success или error.
                    success: function (response) {
                      if (response.result == 'доступ разрешен') {
                        resultField.style.color = "#00000000";
                        resultField.style.color = "#00c0f0";
                        resultField.textContent = response.result;
                        setTimeout(() => {
                            window.location.href = "{% url 'personalpage' %}";
                          }, 1000);
                        }
                      else {
                        resultField.textContent = response.result;
                        resultField.style.color = "#00000000";
                        setTimeout(() => {
                          resultField.style.color = "#ff1943";
                          }, 500);
                      }
                      },
                    error: function (response) {
                      resultField.textContent = "возникла ошибка";
                      resultField.style.color = "#00000000";
                      setTimeout(() => {
                          resultField.style.color = "#ff1943";
                          }, 500);
                      }
                });
                // return false в конце скрипта предотвращает отправку форм, останавливая перезагрузку страницы.
                return false;
            });
        })    
    </script>
    <!--  -->

    <!-- регистрация форма -->
    <div class="modal fade" id="registration_form_container" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <h4 class="modal-title text-center">РЕГИСТРАЦИЯ</h4><br>
          <form method="POST" action="" id="registration_form">
            {% csrf_token %}
            <div class="pad-notop-4">
              <label>Логин</label>
              <p>
                {{ registration_form.username }}
                <span class="helptext" id="username_error">&nbsp;</span>
              </p>
              <label>Пароль</label>
              <p>
                {{ registration_form.password1 }}
              </p>
              <label>Подтверждение пароля</label>
              <p>
                {{ registration_form.password2 }}
                <span class="helptext" id="password2_error">&nbsp;</span>
              </p>

              <span id="registration_form_result" class="error">&nbsp;</span>
              <button type="submit" class="btn btn-primary">СОЗДАТЬ АККАУНТ</button>
            </div>
          </form>

        </div>
      </div>
    </div>
    <!--  -->

    <!-- регистрация скрипт -->
    <script>
      $(document).ready(function () {
          // отслеживаем событие отправки формы
          $('#registration_form').submit(function () {

              resultField = document.getElementById("registration_form_result");
              
              // создаем AJAX-вызов
              $.ajax({
                  data: $(this).serialize(), // получаем данные формы
                  type: $(this).attr('method'), // метод отправки запроса
                  url: "{% url 'registration' %}", // функция обработки
                  
                  // После успешного завершения запросов запускается одна из колбэк-функций success или error.
                  success: function (response) {
                    if (response.result == 'успешный успех') {
                      document.getElementById("username_error").textContent = "";
                      document.getElementById("password2_error").textContent = "";
                      resultField.style.color = "#00000000";
                      resultField.textContent = response.result;
                      resultField.style.color = "#00c0f0";
                      setTimeout(() => {
                          window.location.href = "{% url 'personalpage' %}";
                      }, 1700);
                      }
                    else {
                      resultField.style.color = "#00000000";
                      document.getElementById("username_error").style.color = "#00000000";
                      document.getElementById("password2_error").style.color = "#00000000";
                      for (var key in response.result) {
                        document.getElementById(key + "_error").style.color = "#00000000";
                        for (let i=0; i<response.result[key].length; i++) {
                          response.result[key][i] = '&#8226; ' + response.result[key][i];
                        }
                        document.getElementById(key + "_error").innerHTML = response.result[key].join("\n");
                        document.getElementById(key + "_error").style.color = "#0055d5";
                      }
                    }
                    },
                  error: function (response) {
                    resultField.style.color = "#00000000";
                    resultField.textContent = "возникла ошибка";
                    resultField.style.color = "#ff1943";
                    }
              });
              // return false в конце скрипта предотвращает перезагрузку страницы.
              return false;
          });
      })    
    </script>
    <!--  -->

    <main>
      {% block content %}
      {% endblock %}
    </main>

    <footer>
      <div class="container">
        <div class="d-flex flex-wrap justify-content-between align-items-center py-3">
          <div class="d-flex flex-column">
            <div class="p-2 d-flex align-items-center">
              <span class="mb-3 mb-md-0 me-2 text-white">Поддержка сервиса</span>
            </div>
            <div class="px-2 d-flex">
              <a href="mailto:demmenty@gmail.com" target="_blank" class="mail_ref">Demmenty@gmail.com</a>
            </div>
            <div class="d-flex align-items-center">
              <div class="p-2 d-flex justify-content-end">
                <a href="https://t.me/demmenty" target="_blank"><img src="{% static 'general/img/telegram.svg' %}" class="contact_ico" alt="telegram" title="telegram"></a>
              </div>
              <div class="p-2 d-flex justify-content-end">
                <a href="https://wa.me/79273719237" target="_blank"><img src="{% static 'general/img/whatsapp.svg' %}" class="contact_ico" alt="whatsapp" title="whatsapp"></a>
              </div>
              <div class="p-2 d-flex justify-content-end">
                <a href="https://vk.com/id93683216" target="_blank"><img src="{% static 'general/img/vk.svg' %}" class="contact_ico" alt="vkontakte" title="vkontakte"></a>
              </div>
            </div>
          </div>
          <div class="d-flex align-items-center">
            <span class="mb-3 mb-md-0 text-white">© 2022 ИП Рябов Р.А.</span>
          </div>
          <div class="d-flex flex-column" id="trainer_contacts">
            <div class="d-flex align-items-center">
              <span class="p-2 mb-3 mb-md-0 me-2 text-white">Контакты эксперта</span>
            </div>
            <div class="px-2 d-flex">
              <a href="mailto:parrabolla@mail.ru" target="_blank" class="mail_ref">Parrabolla@mail.ru</a>
            </div>
            <div class="d-flex align-items-center">
              <div class="p-2 d-flex justify-content-end">
                <a href="https://t.me/parrrabollla" target="_blank"><img src="{% static 'general/img/telegram.svg' %}" class="contact_ico" alt="telegram" title="telegram"></a>
              </div>
              <div class="p-2 d-flex justify-content-end">
                <a href="https://wa.me/79603280691" target="_blank"><img src="{% static 'general/img/whatsapp.svg' %}" class="contact_ico" alt="whatsapp" title="whatsapp"></a>
              </div>
              <div class="p-2 d-flex justify-content-end">
                <a href="https://discord.gg/CDrXhVA" target="_blank"><img src="{% static 'general/img/discord.svg' %}" class="contact_ico" alt="discord" title="discord"></a>
              </div>
              <div class="p-2 d-flex justify-content-end">
                <a href="https://join.skype.com/invite/ANfPTptWeOxA" target="_blank"><img src="{% static 'general/img/skype.svg' %}"  class="contact_ico" alt="skype" title="skype"></a>
              </div>
              <div class="p-2 d-flex justify-content-end">
                <a href="https://vk.com/id37037617" target="_blank"><img src="{% static 'general/img/vk.svg' %}" class="contact_ico" alt="vkontakte" title="vkontakte"></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
      
  </body>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
  <script src="{% static 'homepage/js/layout.js' %}"></script>
</html>