{% extends 'personalpage/layout.html' %}
{% load static %}

{% block title %}Личный кабинет{% endblock %}

{% block content %}

<h1>Персональная страница клиента: {{ user.username }}</h1><br>

<!-- ссылка на анкету -->
{% if questionary_existing %}
<h3>Вашу анкету можно изменить тут</h3>
{% else %}
<h3>Пожалуйста, заполните анкету</h3>
{% endif %}
<a href="{% url 'questionary' %}"><button class="btn btn-info">Анкета</button></a><br><br>

<!-- измерения за сегодня -->
{% if today_measure %}
    <h3>Данные измерений за сегодня</h3><br>

    <div class="table-responsive today_measure_table">
        <table class="table table-bordered table-fixed text-center">
            <tr><th class="tablerow_name">Дата</th><td>{{ today_measure.date }}</td></tr>
            <tr><th class="tablerow_name">Самочувствие</th><td>{% if today_measure.feel %}{{ today_measure.feel }}/10{% else %}-{% endif %}</td></tr>
            <tr><th class="tablerow_name">Вес</th><td>{% if today_measure.weight %}{{ today_measure.weight }} кг{% else %}-{% endif %}</td></tr>
            <tr><th class="tablerow_name">Процент жира</th><td>{% if today_measure.fat %}{{ today_measure.fat }} %{% else %}-{% endif %}</td></tr>
            <tr><th class="tablerow_name">Пульс в покое</th><td>{% if today_measure.pulse %}{{ today_measure.pulse }} уд/мин{% else %}-{% endif %}</td></tr>
            {% if today_measure.pressure_upper and today_measure.pressure_lower %}<tr><th class="tablerow_name">Давление</th><td>{{ today_measure.pressure_upper }}/{{ today_measure.pressure_lower }}</td></tr>{% endif %}
            <tr><th class="tablerow_name">Калории</th><td>{{ today_measure.calories|default_if_none:"-" }}</td></tr>
            <tr><th class="tablerow_name">Белки</th><td>{{ today_measure.protein|default_if_none:"-" }}</td></tr>
            <tr><th class="tablerow_name">Жиры</th><td>{{ today_measure.fats|default_if_none:"-" }}</td></tr>
            <tr><th class="tablerow_name">Углеводы</th><td>{{ today_measure.carbohydrates|default_if_none:"-" }}</td></tr>
            {% if today_measure.comment %}<tr><th class="tablerow_name">Комментарий</th><td>{{ today_measure.comment }}</td></tr>{% endif %}
        </table>
        <p class="error_message">{{ error }}</p>
    </div><br>
    
    <a href="{% url 'addmeasure' %}"><button class='btn btn-info'>Редактировать записи</button></a><br><br>
{% else %}
    <p>За сегодня измерений не сделано.</p><br>
    <p>Данные необходимо вносить каждый день!</p><br>
    <a href="{% url 'addmeasure' %}"><button class='btn btn-info'>Добавить запись</button></a><br><br>
{% endif %}

<!-- дневник питания -->
<a href="{% url 'mealjournal' %}"><button class='btn btn-info'>Дневник питания</button></a><br><br>

<!-- измерения за неделю-->
<h3>Данные измерений за неделю</h3><br>


    <table class="week_table table table-bordered border-primary align-middle text-center">
        <thead>
            <tr>
                <!-- сделать всплывающие комменты -->
                <th>Дата</th>
                <th>День</th>
                <th>Самочувствие</th>
                <th>Масса</th>
                <th>Жирность</th>
                <th>Пульс</th>
                <!-- убрать столбик давления, если не измеряется -->
                <th>Давление</th>
                <th>Калории</th>
                <th>Белки</th>
                <th>Жиры</th>
                <th>Углеводы</th>
            </tr>
        </thead>
        <tbody>
            {% for day in week %}
            <tr>
                <td>{{ day.date|date:"j b" }}</td>
                <td>{{ day.date|date:"D" }}</td>
                <td>{% if day.feel %}{{ day.feel }}/10{% endif %}</td>
                <td>{% if day.weight %}{{ day.weight }} кг{% endif %}</td>
                <td>{% if day.fat %}{{ day.fat }} %{% endif %}</td>
                <td>{{ day.pulse|default_if_none:"" }}</td>
                <td>{% if day.pressure_upper is not None and day.pressure_lower is not None %}{{ day.pressure_upper }}/{{ day.pressure_lower }}{% else %}{% endif %}</td>
                <td>{{ day.calories|default_if_none:"" }}</td>
                <td>{{ day.protein|default_if_none:"" }}</td>
                <td>{{ day.fats|default_if_none:"" }}</td>
                <td>{{ day.carbohydrates|default_if_none:"" }}</td>
            </tr>
            {% endfor %}
            <tr>
                <th colspan="2">В среднем:</th>
                <th>{{ avg_week.avg_feel|default:"" }}</th>
                <th>{{ avg_week.avg_weight|default:"" }}</th>
                <th>{{ avg_week.avg_fat|default:"" }}</th>
                <th>{{ avg_week.avg_pulse|default:"" }}</th>
                <th>{{ avg_week.avg_pressure|default:"" }}</th>
                <th>{{ avg_week.avg_calories|default:"" }}</th>
                <th>{{ avg_week.avg_protein|default:"" }}</th>
                <th>{{ avg_week.avg_fats|default:"" }}</th>
                <th>{{ avg_week.avg_carbohydrates|default:"" }}</th>
            </tr>
        </tbody>
    </table>

<p>* среднее КБЖУ считается без учета сегодняшнего дня</p><br>


<!-- Статистика за произвольную дату -->
{% if selected_period %}

<h3>Данные измерений за {{ selected_period }}</h3><br>

<table class="table table-bordered border-primary align-middle text-center">
    <tr> 
        <th>Дата</th>
        <th>День</th>
        <th>Самочувствие</th>
        <th>Масса</th>
        <th>Жирность</th>
        <th>Пульс</th>
        <th>Давление</th>
        <th>Калории</th>
        <th>Белки</th>
        <th>Жиры</th>
        <th>Углеводы</th>
    </tr>
    {% for day in period %}
    <tr>
        <td>{{ day.date|date:"j b" }}</td>
        <td>{{ day.date|date:"D" }}</td>
        <td>{% if day.feel %}{{ day.feel }}/10{% endif %}</td>
        <td>{% if day.weight %}{{ day.weight }} кг{% endif %}</td>
        <td>{% if day.fat %}{{ day.fat }} %{% endif %}</td>
        <td>{{ day.pulse|default_if_none:"" }}</td>
        <td>{% if day.pressure_upper is not None and day.pressure_lower is not None %}{{ day.pressure_upper }}/{{ day.pressure_lower }}{% else %}{% endif %}</td>
        <td>{{ day.calories|default_if_none:"" }}</td>
        <td>{{ day.protein|default_if_none:"" }}</td>
        <td>{{ day.fats|default_if_none:"" }}</td>
        <td>{{ day.carbohydrates|default_if_none:"" }}</td>
    </tr>
    {% endfor %}
    <tr>
        <th colspan="2">В среднем:</th>
        <th>{{ avg_period.avg_feel|default:"" }}</th>
        <th>{{ avg_period.avg_weight|default:"" }}</th>
        <th>{{ avg_period.avg_fat|default:"" }}</th>
        <th>{{ avg_period.avg_pulse|default:"" }}</th>
        <th>{{ avg_period.avg_pressure|default:"" }}</th>
        <th>{{ avg_period.avg_calories|default:"" }}</th>
        <th>{{ avg_period.avg_protein|default:"" }}</th>
        <th>{{ avg_period.avg_fats|default:"" }}</th>
        <th>{{ avg_period.avg_carbohydrates|default:"" }}</th>
    </tr>
</table><br>

{% endif %}

<!-- Выбор дней статистики -->
<form action="" method="get" class="period_select">
    <h5>Статистика за
    <input type="number" class="form-control text-center d-inline" name="selectperiod" min="1" id="input_period">
    дней</h5>
    <button type="submit" class="btn btn-info d-inline" name="submit">Получить</button></h5>
</form>
<br><br>

    
<script src="{% static 'personalpage/js/personalpage.js' %}"></script>
{% endblock %}