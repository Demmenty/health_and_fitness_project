{% extends 'personalpage/layout.html' %}
{% load static %}
{% load i18n %}

{% block title %}Дневник питания{% endblock %}

{% block content %}

<!-- Сводка за выбраннную дату -->
<h3 class="text-center">{{ briefdate|date:"l" }} {{ briefdate|date }}</h3><br>
{% if food_entry %}

<table class="table table-bordered">
    <thead class="table-light">
        <tr>
            <th>Категория</th>
            <th>Продукт</th>
            <th class="text-center">Количество</th>
            <th class="text-center">Калории</th>
            <th class="text-center">Белки</th>
            <th class="text-center">Жиры</th>
            <th class="text-center">Углеводы</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            {% for category, count in count_meal_in_category.items %}
            {% if count > 0 %}
            <td rowspan="{{ count }}">{% translate category %}</td>
            {% endif %}
            {% for food in food_entry %}
            {% if food.meal == category %}
            <td>{{ food.food_entry_name }}</td>
            <td class="text-center">{{ food.norm_amount }} {{ food.serving.metric_serving_unit }}</td>
            <td class="text-center">{{ food.calories }}</td>
            <td class="text-center">{{ food.protein }}</td>
            <td class="text-center">{{ food.fat }}</td>
            <td class="text-center">{{ food.carbohydrate }}</td> 
        </tr>
            {% endif %}
            {% endfor %}
            {% endfor %}
        <tr class="table-light">
            <th colspan="2" class="text-end">Всего:</th>
            <th class="text-center">{{ day_total.amount }} g/ml</th>
            <th class="text-center">{{ day_total.calories }}</th>
            <th class="text-center">{{ day_total.protein }}</th>
            <th class="text-center">{{ day_total.fat }}</th>
            <th class="text-center">{{ day_total.carbohydrate }}</th>
        </tr>
    </tbody>
</table>
<br><br>

<!-- топчики -- добавить margin -->
<h3 class="text-center">Топ по количеству</h3><br>

<ol>
<table class="table">
    <thead class="table-light">
        <tr>
            <th></th>
            <th>Название продукта</th>
            <th class="text-center">Съедено</th>
            <th class="text-center">Получено калорий</th>
        </tr>
    </thead>
    <tbody>
    {% for product, value in top_amount.items %}
        <tr>
            <td></td>
            <td><li>{{ product }}</li></td>
            <td class="text-center">{{ value.amount }} {{ value.metric }}</td>
            <td class="text-center">{{ value.calories }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
</ol>
<br>

<h3 class="text-center">Топ по калориям</h3><br>

<ol>
<table class="table">
    <thead class="table-light">
        <tr>
            <th></th>
            <th>Название продукта</th>
            <th class="text-center">Съедено</th>
            <th class="text-center">Получено калорий</th>
        </tr>
    </thead>
    <tbody>
    {% for product, value in top_calories.items %}
        <tr>
            <td></td>
            <td><li>{{ product }}</li></td>
            <td class="text-center">{{ value.amount }} {{ value.metric }}</td>
            <td class="text-center">{{ value.calories }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
</ol>
<br>


{% else %}
<p>Данные отсутствуют</p>
{% endif %}
<br>

<!-- добавить кнопки следубщий день и предыдущий день! -->
<!-- Выбор сводки за другое число -->
<h5>Нужна сводка за другое число?</h5>
<form action = "{% url 'foodbydate' %}" method = "get">
    <input type="date" class="form-control text-center" name="date" id="input_briefdate">
    <button type="submit" class="btn btn-info" name="submit">Получить</button>
</form>
<br><br>

<!-- Кнопка возврата -->
<a href="{% url 'mealjournal' %}"><button class="btn btn-outline-primary" id="back_btn_questionary">Вернуться</button></a>


{% endblock %}